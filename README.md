# Project Name

ps-payment

## Prerequisites

- Node.js >= 18
- npm

## Installation

```bash
git clone https://github.com/username/repo-name.git
cd ps-payment
npm install
```

## Run
```bash
npx ts-node src/index.ts   
```

# Design

- Service in this system:
    + invoice service: contain table Invoice (main), InvoiceItem
    + payment service: contain table: Payment, Receipt, Invoice (reference based on Invoice)
- Implement Saga pattern to control status in payment process
```js
eventBus.on(PaymentProcessEvents.InvoiceCreateSuccess, (message) => {
      // Send info to payment about new invoice
      eventBus.emit(PaymentEvents.PaymentCreate, message);
    });
    eventBus.on(PaymentProcessEvents.PaymentCreateFailed, (message) => {
      // Cancel invoice status
      eventBus.emit(InvoiceEvents.InvoiceCancel, message);
    });
    eventBus.on(PaymentProcessEvents.PaymentCreateSuccess, (message) => {});
    eventBus.on(PaymentProcessEvents.InvoicePaymentApplied, (message) => {
      // Update invoice outstanding balance
      eventBus.emit(InvoiceEvents.InvoiceUpdated, message);
    });

```
- Invoice creates at the time order completion. No action for payment here
- Receipt stores info about this payment
- ReceiptItem stores item info as InvoiceItem, but it can not be edited (simulate store in dedicate db);
- Receipt will be generated correspondingly with payment (they go along)
- Id will be generated by name and increase number for easily keep track (refer ./src/utils/index.ts);
- All amount in this system will be rounded by 2 decimals


# Assumption
- invoiceNumber and invoiceId; receiptNumber and receiptId; will be treated as the same (for reference only)
- Receipt will be generated correspondingly with payment (they go along)
- Customer can pay more at 1 time and receiving Cash back. After the invoice complete, no action can be take

# Limitation
- Skip validation when transmitting and receiving data between services
- No transaction here

# Lib
- Joi: for validating
